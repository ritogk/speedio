<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<style>
			html,
			body {
				margin: 0;
				padding: 0;
				height: 100%;
				font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
				background: #000;
				color: #e5e7eb;
			}

			.app-root {
				display: flex;
				flex-direction: column;
				height: 100%;
				position: relative;
				z-index: 1;
				background: transparent;
			}

			#bg-video {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				object-fit: cover;
				z-index: 0;
			}

			.video-setup {
				/* スライダー上に配置するため、通常フロー内の小さな行として表示 */
				position: static;
				margin: 4px 12px 0;
				background: rgba(15, 23, 42, 0.85);
				border-radius: 8px;
				padding: 4px 8px;
				display: inline-flex;
				align-items: center;
				gap: 6px;
				font-size: 11px;
			}

			.video-setup input {
				width: 80px;
				padding: 2px 4px;
				border-radius: 4px;
				border: 1px solid #4b5563;
				background: rgba(15, 23, 42, 0.9);
				color: #e5e7eb;
			}

			.video-setup button {
				padding: 4px 8px;
				border-radius: 999px;
				border: none;
				font-size: 11px;
				cursor: pointer;
				background: #16a34a;
				color: #ecfdf5;
			}

			header {
				padding: 8px 16px;
				background: #020617;
				border-bottom: 1px solid #1e293b;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			header h1 {
				font-size: 16px;
				margin: 0;
			}

			header .meta {
				font-size: 12px;
				color: #9ca3af;
			}

			.main-layout {
				flex: 1;
				display: grid;
				grid-template-columns: minmax(0, 2fr) minmax(0, 1.6fr);
				gap: 0;
				min-height: 0;
			}

			.left-pane {
				display: flex;
				flex-direction: column;
				min-height: 0;
				grid-column: 2;
			}

			/* Path view (地図なしの2Dビュー) */
			#map-container {
				position: relative;
				background: transparent;
				display: flex;
				align-items: stretch;
				justify-content: center;
				flex: 1;
			}

			#path-view {
				width: 100%;
				height: 100%;
				display: block;
				background: transparent;
			}

			/* Right pane */
			.right-pane {
				display: flex;
				flex-direction: column;
				min-height: 0;
				grid-column: 1;
				border-right: 1px solid #111827;
			}

			.controls {
				padding: 8px 12px;
				border-bottom: 1px solid #111827;
				display: flex;
				align-items: center;
				gap: 8px;
				background: #020617;
			}

			.controls button {
				padding: 6px 12px;
				border-radius: 999px;
				border: none;
				font-size: 13px;
				cursor: pointer;
				background: #16a34a;
				color: #ecfdf5;
			}

			.controls button.secondary {
				background: #374151;
				color: #e5e7eb;
			}

			.controls button:disabled {
				opacity: 0.5;
				cursor: default;
			}

			.controls .slider {
				flex: 1;
				display: flex;
				align-items: center;
				gap: 6px;
			}

			.controls input[type="range"] {
				flex: 1;
			}

			.controls .time-label {
				font-size: 11px;
				color: #9ca3af;
				min-width: 130px;
				text-align: right;
			}

			.status-bar {
				padding: 4px 12px;
				font-size: 11px;
				color: #9ca3af;
				display: flex;
				gap: 16px;
			}

			.status-bar span strong {
				color: #e5e7eb;
			}

			.chart-container {
				flex: 0 0 auto;
				padding: 4px 8px 4px;
				display: flex;
				flex-direction: column;
				gap: 4px;
				min-height: 0;
			}

			.chart-header {
				display: none;
			}

			.chart-wrapper {
				flex: 0 0 auto;
				background: transparent;
				border-radius: 8px;
				/* 外枠ボーダーは不要なので消す */
				border: none;
				padding: 6px 8px 10px;
				display: flex;
				flex-direction: column;
				min-height: 0;
			}

			#elevation-chart {
				flex: 0 0 auto;
				height: 220px;
			}

			.chart-caption {
				display: none;
			}

			.legend {
				/* 凡例（色情報）は非表示にする */
				display: none;
			}

			.legend-item {
				display: inline-flex;
				align-items: center;
				gap: 4px;
			}

			.legend-color {
				width: 10px;
				height: 3px;
				border-radius: 999px;
			}

			.legend-color.path-total {
				background: #4b5563;
			}

			.legend-color.path-played {
				background: #f97316;
			}

			.legend-color.chart-elev {
				background: #4b5563;
			}

			.legend-color.chart-cursor {
				background: #fbbf24;
			}

			.error-banner {
				padding: 6px 10px;
				font-size: 12px;
				background: rgba(127, 29, 29, 0.6);
				border-bottom: 1px solid #7f1d1d;
				color: #fecaca;
			}

			@media (max-width: 900px) {
				.main-layout {
					grid-template-columns: minmax(0, 1fr);
					grid-template-rows: minmax(0, 1.2fr) minmax(0, 1fr);
				}

				.left-pane {
					border-right: none;
					border-bottom: 1px solid #111827;
				}
			}
		</style>
	</head>
		<body>
			<video id="bg-video" src="363.mp4" muted playsinline preload="metadata"></video>
			<div class="app-root">
				<div id="error" class="error-banner" style="display: none"></div>

				<div class="main-layout">
				<div class="left-pane">
					<div class="chart-container">
						<div class="chart-header">
							<span>標高プロファイル</span>
							<span id="chart-range" style="font-size: 11px; color: #6b7280"></span>
						</div>

						<div class="chart-wrapper">
							<svg id="elevation-chart" viewBox="0 0 800 220" preserveAspectRatio="none"></svg>
							<div class="legend">
								<div class="legend-item">
									<span class="legend-color path-total"></span>
									<span>全区間（地図）</span>
								</div>
								<div class="legend-item">
									<span class="legend-color path-played"></span>
									<span>再生済み区間（地図）</span>
								</div>
								<div class="legend-item">
									<span class="legend-color chart-elev"></span>
									<span>標高 (m)</span>
								</div>
								<div class="legend-item">
									<span class="legend-color chart-cursor"></span>
									<span>現在位置</span>
								</div>
							</div>
							<div class="chart-caption">スライダー or 再生ボタンで、時間に沿って位置と標高が同期して動きます。</div>
						</div>
					</div>

					<div id="map-container">
						<svg id="path-view" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid meet"></svg>
					</div>
				</div>

					<div class="right-pane">
						<div id="video-time-setup" class="video-setup">
							<span>動画開始位置</span>
							<input id="video-start-input" type="text" placeholder="mm:ss または 秒" />
							<button id="video-start-apply">OK</button>
						</div>
						<div class="controls">
						<button id="play-btn">▶ 再生</button>
						<button id="pause-btn" class="secondary" disabled>⏸ 一時停止</button>

						<div class="slider">
							<input id="index-slider" type="range" min="0" max="0" value="0" step="1" />
						</div>

						<div class="time-label">
							<div id="playback-elapsed">00:00 / 00:00</div>
							<div id="time-label-abs">--:--:--</div>
						</div>
					</div>

					<div class="status-bar">
						<span>Index: <strong id="status-index">-</strong></span>
						<span>標高: <strong id="status-elev">- m</strong></span>
						<span>座標: <strong id="status-latlon">-</strong></span>
					</div>
				</div>
			</div>
		</div>

			<script type="module" src="./main.js"></script>
	</body>
	</html>

