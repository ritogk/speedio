

from geopandas import GeoDataFrame
from pandas import Series
import numpy as np
from scipy.interpolate import splprep, splev

geometry_list = [[36.6123652, 139.5384086], [36.6124817, 139.5383661], [36.6128377, 139.5382693], [36.6129603, 139.5382521], [36.613108, 139.5382387], [36.6131971, 139.538244], [36.6132988, 139.538265], [36.6134332, 139.5382615], [36.6135149, 139.538293], [36.6136015, 139.5383249], [36.6137073, 139.5383778], [36.6138336, 139.5384652], [36.613871, 139.5384957], [36.6139775, 139.5385783], [36.6141281, 139.5387241], [36.6142013, 139.5387969], [36.6142732, 139.5388683], [36.6143519, 139.5389395], [36.6144282, 139.5389983], [36.6145104, 139.5390503], [36.6145726, 139.5390998], [36.6147347, 139.539238], [36.6148425, 139.5393172], [36.6151781, 139.539404], [36.6153409, 139.5394397], [36.6154455, 139.5394936], [36.6155396, 139.5396135], [36.6155761, 139.5397811], [36.6155873, 139.5399331], [36.6155584, 139.5403248], [36.6155517, 139.5404277], [36.6155534, 139.5405258], [36.6156025, 139.540686], [36.615691, 139.5408362], [36.6157962, 139.5408951], [36.6159194, 139.5409498], [36.616142, 139.5410546], [36.6163345, 139.5411164], [36.6164974, 139.5411402], [36.6166431, 139.5410975], [36.6167598, 139.5410624], [36.6168488, 139.5409987], [36.6169374, 139.540881], [36.6169922, 139.5407461], [36.6170564, 139.5404698], [36.6170865, 139.5403288], [36.6171065, 139.5402324], [36.6171201, 139.5401816], [36.6171262, 139.5400986], [36.6171395, 139.5399967], [36.6172302, 139.5397913], [36.6173315, 139.5396435], [36.6174712, 139.5394978], [36.6175662, 139.5393641], [36.6176569, 139.5392202], [36.6176899, 139.5390911], [36.6176967, 139.5388645], [36.6176837, 139.5386924], [36.6176687, 139.5385046], [36.6176539, 139.5383278], [36.6176525, 139.538146], [36.6176648, 139.537972], [36.6176893, 139.5378048], [36.6177453, 139.5376154], [36.6178139, 139.5374353], [36.6178862, 139.5372712], [36.6179799, 139.5371244], [36.6180778, 139.5370286], [36.6181599, 139.5369782], [36.6182463, 139.5369523], [36.618343, 139.5369479], [36.6184715, 139.5369774], [36.6186585, 139.5370561], [36.6188698, 139.5371397], [36.6191209, 139.5372815], [36.6194761, 139.5374553], [36.6197904, 139.5376238], [36.6200397, 139.5376839], [36.620379, 139.5376634], [36.6208422, 139.5374181], [36.6210452, 139.5374155], [36.6211732, 139.5375425], [36.6212223, 139.5377204], [36.621204, 139.5379278], [36.6211695, 139.5380985], [36.6210471, 139.5385304], [36.6209718, 139.5388911], [36.6209937, 139.5391319], [36.6210164, 139.539242], [36.6211909, 139.5400538], [36.6212049, 139.540119], [36.6212548, 139.5403363], [36.6213163, 139.5405254], [36.6214253, 139.5407621], [36.6216611, 139.5412229], [36.6217135, 139.5412934], [36.6217744, 139.5413452], [36.6218573, 139.5413828], [36.6219308, 139.5413903], [36.622007, 139.5413812], [36.6220635, 139.5413674], [36.6224276, 139.5411586], [36.6227415, 139.5409282], [36.6230219, 139.5406296], [36.6231421, 139.5405515], [36.6232064, 139.5405355], [36.6232758, 139.5405285], [36.6233584, 139.5405621], [36.6234806, 139.540642], [36.6238956, 139.5410333], [36.6240305, 139.5411186], [36.624234, 139.5412194], [36.6243698, 139.5412725], [36.6244889, 139.5412964], [36.6246575, 139.5413183], [36.6248505, 139.5413096], [36.6250889, 139.541286], [36.625773, 139.5411739], [36.6260301, 139.5411042], [36.6264626, 139.5409415], [36.626749, 139.5407944], [36.6268505, 139.540713], [36.6271206, 139.5404692], [36.6273064, 139.5403389], [36.6274881, 139.5402465], [36.6276539, 139.5401982], [36.6278145, 139.5401673], [36.6279569, 139.5401548], [36.6284302, 139.5401995], [36.6285593, 139.540199], [36.6286297, 139.5401912], [36.6286831, 139.5401702], [36.628747, 139.5401253], [36.6288041, 139.5400685], [36.6288568, 139.5399831], [36.6288931, 139.5398939], [36.6289114, 139.5397977], [36.6289215, 139.539725], [36.628916, 139.5396331], [36.6288401, 139.5390603], [36.6287967, 139.538673], [36.6287415, 139.5381723], [36.628743, 139.5380207], [36.628782, 139.5378934], [36.6288306, 139.5378186], [36.6289085, 139.5377556], [36.6289954, 139.5377251], [36.629103, 139.5377353], [36.6292977, 139.5378186], [36.6297817, 139.538069], [36.6301247, 139.5384472], [36.6303046, 139.53859], [36.6305099, 139.5385126], [36.6305414, 139.5382097], [36.6305847, 139.5378306], [36.6306258, 139.5376121], [36.6307846, 139.5375321], [36.6310578, 139.537752], [36.6313222, 139.5378499], [36.6314401, 139.5377337], [36.6315555, 139.5374001], [36.6315935, 139.5367604], [36.6315322, 139.5364488], [36.6315514, 139.5360817], [36.6315899, 139.5357278], [36.6314934, 139.5353677], [36.6315913, 139.5350954], [36.6317643, 139.5349983], [36.631961, 139.5350935], [36.6329212, 139.5362237], [36.6335841, 139.5373555], [36.6337462, 139.537555], [36.6341705, 139.537894], [36.6342557, 139.5380093], [36.6343768, 139.5383295], [36.6344644, 139.5384366], [36.6346076, 139.5384754], [36.6350892, 139.538257], [36.6352927, 139.538112], [36.6354472, 139.5379368], [36.6357744, 139.5374793], [36.635967, 139.5371858], [36.63619, 139.5370395], [36.6368491, 139.5368289], [36.6373344, 139.5365931], [36.63754, 139.5364764], [36.6376311, 139.536417], [36.6379957, 139.536178], [36.6384864, 139.5358526], [36.6388397, 139.5356167], [36.6389455, 139.535538], [36.6390358, 139.5354491], [36.6390982, 139.5353445], [36.6391427, 139.5352382], [36.6391649, 139.5351179], [36.6391649, 139.5349744], [36.6391444, 139.5348373], [36.6389951, 139.5342495], [36.6387882, 139.5339312], [36.6383203, 139.5336784], [36.638253, 139.5336059], [36.6382111, 139.5335339], [36.6381716, 139.5334335], [36.6381512, 139.5333396], [36.6381418, 139.533246], [36.6381469, 139.5331505], [36.6381641, 139.5330499], [36.6382065, 139.5328905], [36.6382193, 139.5328475], [36.6382846, 139.5326288], [36.6384235, 139.5321849], [36.6384873, 139.5320171], [36.6385504, 139.5319261], [36.638601, 139.5318644], [36.638687, 139.5317962], [36.6387571, 139.5317656], [36.6388044, 139.5317557], [36.6388754, 139.5317477], [36.6389359, 139.5317529], [36.6390175, 139.5317705], [36.6390863, 139.5318134], [36.6391574, 139.5318751], [36.6392135, 139.5319391], [36.6392859, 139.5320643], [36.6394224, 139.5324012], [36.6394942, 139.5325229], [36.6395932, 139.5326516], [36.6397101, 139.5327841], [36.64041, 139.5333919], [36.6404944, 139.5334908], [36.6405714, 139.5336065], [36.6406551, 139.5337976], [36.6407537, 139.5341263], [36.6408167, 139.5343079], [36.6408781, 139.5344339], [36.6409953, 139.5345824], [36.6412955, 139.5348619], [36.6414475, 139.5349791], [36.6415269, 139.5350133], [36.6416109, 139.5350254], [36.6417056, 139.5350347], [36.641798, 139.5350124], [36.6419078, 139.5349679], [36.642462, 139.5346132], [36.6425698, 139.5345177], [36.6428236, 139.5342153], [36.6428851, 139.5341253], [36.6429363, 139.5340099], [36.6430281, 139.5336319], [36.6430693, 139.5335388], [36.6431195, 139.5334885], [36.6431847, 139.5334582], [36.6432573, 139.5334563], [36.6433653, 139.5334693], [36.6434316, 139.5334536], [36.6434918, 139.533416], [36.6435471, 139.5333618], [36.6435844, 139.5332578], [36.6435945, 139.533159], [36.643575, 139.5330456], [36.6435241, 139.5328943], [36.6434704, 139.5327222], [36.6432874, 139.531686], [36.6432878, 139.5315559], [36.6433304, 139.5314379], [36.6433853, 139.5313548], [36.6434715, 139.5312919], [36.6435387, 139.5312577], [36.6436909, 139.5311858], [36.6438711, 139.5311071], [36.6439443, 139.5311007], [36.6440531, 139.5311181], [36.6441181, 139.531167], [36.6441902, 139.5312488], [36.6443161, 139.5314902], [36.6443925, 139.5316055], [36.6444861, 139.5317008], [36.6445156, 139.5317176], [36.6446154, 139.5317743], [36.6447056, 139.5317906], [36.6447906, 139.5317906], [36.6448928, 139.5317763], [36.6449935, 139.531728], [36.6450947, 139.5316542], [36.6452748, 139.5315224], [36.6458356, 139.531054], [36.6466903, 139.5303795], [36.6474044, 139.5298013], [36.6490134, 139.5285002], [36.6491377, 139.5283986], [36.6492074, 139.5283538], [36.6493292, 139.5282756], [36.6494721, 139.528227], [36.6496671, 139.5282219], [36.6498977, 139.5282471], [36.6507188, 139.5283247], [36.6508957, 139.5283442], [36.6510959, 139.5283473], [36.6511716, 139.528345], [36.6513079, 139.5283239], [36.6514305, 139.5282875], [36.6516282, 139.5282204], [36.6530305, 139.5276749], [36.6532477, 139.5276011], [36.6533316, 139.5275918], [36.6533826, 139.5275994], [36.653424, 139.5276351]]
# fd

def run(geometry_list):
    if len(geometry_list) < 3:
        # 三次スプラインは最低3点必要
        return geometry_list

    coords = np.array(geometry_list)
    x, y = coords[:, 0], coords[:, 1]

    try:
        # 三次スプライン (必ず全ての点を通過) s=0
        tck, u = splprep([x, y], s=0, k=3)

        # 補間後の座標を生成 (元の点数の3倍程度)
        unew = np.linspace(0, 1, max(len(coords) * 3, 50))
        out = splev(unew, tck)

        smoothed_coords = [[out[0][i], out[1][i]] for i in range(len(unew))]
        return smoothed_coords

    except Exception as e:
        print(f"Spline interpolation failed: {e}")
        return geometry_list
result = run(geometry_list)

# before afterを重ねて表示(各点は繋げて表示する)
import matplotlib.pyplot as plt
before = np.array(geometry_list)
after = np.array(result)

# 元の座標と滑らか化後の座標を分離
orig_coords = np.array(before)
smooth_coords = np.array(after)

# 図を作成
plt.figure(figsize=(14, 10))

# 元のジオメトリを描画（赤い線、太め）
plt.plot(orig_coords[:, 0], orig_coords[:, 1], 'r-', linewidth=2, 
        label=f'元のジオメトリ ({len(before)}点)', alpha=0.8, linestyle='-')

# 滑らか化後のジオメトリを描画（青い線）
plt.plot(smooth_coords[:, 0], smooth_coords[:, 1], 'b-', linewidth=2, 
        label=f'滑らか化後 ({len(after)}点)', alpha=0.7, linestyle='-')

# グラフの設定
plt.xlabel('経度 (Longitude)', fontsize=12)
plt.ylabel('緯度 (Latitude)', fontsize=12)
plt.title('ジオメトリ滑らか化の比較 (先頭1件)', fontsize=14, fontweight='bold')
plt.legend(fontsize=11, loc='best')
plt.grid(True, alpha=0.3, linestyle='--')
plt.axis('equal')

# 背景色を設定
plt.gca().set_facecolor('#f8f9fa')

# 表示
plt.tight_layout()
plt.show()
